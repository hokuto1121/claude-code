# 🏥 医師当直表生成システム (Medical Duty Scheduler)

複雑な制約条件を満たす医師の当直表を自動生成するWebアプリケーションです。

## 📋 主な機能

- **CSV入力対応**: 医師データの簡単アップロード
- **複雑な制約処理**: 不都合日、定期外来日、勤務間隔などを考慮
- **公平性アルゴリズム**: 点数制による負荷分散
- **日本の祝日対応**: 自動的な祝日カレンダー
- **結果出力**: テーブル表示とCSVダウンロード

## 🚀 クイックスタート

### 1. 依存関係のインストール
```bash
npm run install:all
```

### 2. 開発サーバーの起動
```bash
npm run dev
```
- フロントエンド: http://localhost:3000
- バックエンド: http://localhost:3001

### 3. アプリケーションの使用
1. ブラウザで http://localhost:3000 にアクセス
2. 「CSVファイルアップロード」で `docs/sample.csv` をアップロード
3. 開始日: `2025-01-15`、終了日: `2025-02-15` を設定
4. 「当直表を生成」ボタンをクリック
5. 生成された当直表を確認・CSVダウンロード

## 📊 割り当てる役割

- **上当直**: グループ①または②から1名
- **下当直**: グループ③から1名  
- **院内BU**: 上当直がグループ②の場合、グループ①から1名を追加
- **外来担当**: グループ①または②から1名（土曜日のみ・第3土曜除く）
- **外来指導**: 同上

## ⚖️ 制約条件

### 勤務制限
- 医師ごとの「不都合日」はすべて勤務不可
- 「定期外来の前日」は当直・院内BUいずれも不可
- 「院内BUの前日」も当直・BU不可

### 公平性・勤務間隔
- 同じ医師の勤務は最低1日以上空ける
- 外来担当・外来指導の翌日が当直でもOK
- 土日祝の勤務はグループ内でできるだけ公平に割り振る
- グループ①と②の医師は「点数」でバランスをとる

## 🏆 勤務点数システム

| 勤務種別 | 平日 | 土曜 | 日祝 |
|---------|------|------|------|
| 上当直 | 1.0点 | 2.0点 | 1.0点 |
| 下当直 | 0.5点 | 2.0点 | 0.5点 |
| 院内BU | 1.0点 | 1.5点 | 1.5点 |
| 外来担当 | - | 0.5点 | - |
| 外来指導 | - | 0.5点 | - |

## 📁 CSVファイル形式

```csv
氏名,グループ,定期外来日,不都合日
田中太郎,①,月・水,2025-01-20・2025-02-05
佐藤花子,①,火・木,2025-01-25・2025-02-10
鈴木一郎,②,金,2025-01-30
```

### CSV項目説明
- **氏名**: 医師の氏名
- **グループ**: ①、②、③のいずれか
- **定期外来日**: 曜日を「・」区切りで記載（例: 月・水）
- **不都合日**: 日付を「・」区切りで記載（例: 2025-01-20・2025-02-05）

## 🛠 技術構成

### フロントエンド
- React 18
- styled-components
- axios
- moment.js

### バックエンド
- Node.js
- Express
- moment.js
- CSV処理

### アルゴリズム
- 制約満足問題
- 貪欲法
- 公平性最適化

## 📱 対応環境

- Node.js 16.x 以上
- npm 8.x 以上
- モダンブラウザ（Chrome, Firefox, Safari, Edge）

## 🔧 開発コマンド

```bash
# 全体の依存関係インストール
npm run install:all

# フロントエンドのみインストール
npm run install:frontend

# バックエンドのみインストール
npm run install:backend

# 開発サーバー起動（フロント+バック）
npm run dev

# フロントエンドのみ起動
npm run dev:frontend

# バックエンドのみ起動
npm run dev:backend

# プロダクションビルド
npm run build:frontend

# プロダクション起動
npm start
```

## 📋 制限事項

条件をすべて満たせない場合は「条件をすべて満たす勤務表は作成できません」と表示されます。この場合は以下を確認してください：

- 医師数が十分か
- 不都合日の設定が過多でないか
- 期間設定が適切か

## 🤝 貢献方法

1. このリポジトリをフォーク
2. 機能ブランチを作成 (`git checkout -b feature/new-feature`)
3. 変更をコミット (`git commit -am 'Add new feature'`)
4. ブランチにプッシュ (`git push origin feature/new-feature`)
5. プルリクエストを作成

## 📄 ライセンス

MIT License

## 👥 開発者

Claude Code - AI Assistant

---

**医師当直表生成システム - 複雑な制約条件を満たす勤務表を自動生成** 🏥👨‍⚕️👩‍⚕️
