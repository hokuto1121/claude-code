# 医師当直表生成システム 🏥

複雑な制約条件を満たす医師の当直表を自動生成するWebアプリケーションです。

## 📋 機能概要

- **CSVアップロード**: 医師データの簡単読み込み
- **自動スケジューリング**: 複雑な制約を考慮した最適な割り当て
- **公平性管理**: 点数制による負荷分散
- **日本の祝日対応**: 自動的な祝日カレンダー
- **結果出力**: テーブル表示とCSVダウンロード

## 🚀 使用方法

### 1. 依存関係のインストール
```bash
npm run install:all
```

### 2. 開発サーバーの起動
```bash
npm run dev
```
- フロントエンド: http://localhost:3000
- バックエンド: http://localhost:3001

### 3. アプリケーションの使用
1. **CSVファイルの準備**: `docs/sample.csv` を参考に医師データを作成
2. **データアップロード**: Webページで CSVファイルをアップロード
3. **期間設定**: 当直表を作成したい期間を選択
4. **生成実行**: 「当直表を生成」ボタンをクリック
5. **結果確認**: 生成された当直表をブラウザで確認、必要に応じてCSVダウンロード

## 📊 CSVファイル形式

```csv
氏名,グループ,定期外来日,不都合日
田中太郎,①,2025-01-15,2025-01-20,2025-02-10
佐藤花子,①,2025-01-22,2025-01-25,2025-02-15
鈴木一郎,②,2025-01-29,2025-02-05,2025-02-20
```

### 項目説明
- **氏名**: 医師の名前
- **グループ**: ①、②、③のいずれか
- **定期外来日**: カンマ区切りで複数指定可能（空白可）
- **不都合日**: カンマ区切りで複数指定可能

## 🎯 割り当てルール

### 役割
- **上当直**: グループ①または②から1名
- **下当直**: グループ③から1名  
- **院内BU**: 上当直がグループ②の場合、グループ①から1名追加
- **外来担当**: グループ①または②から1名（土曜日のみ・第3土曜除く）
- **外来指導**: 同上

### 制約条件
- 不都合日は勤務不可
- 定期外来の前日は当直・院内BU不可
- 院内BUの前日も当直・BU不可
- 同じ医師の勤務は最低1日以上間隔

### 点数制度
- **平日**: 上当直 1.0点、下当直 0.5点
- **土曜**: 上当直 2.0点、下当直 2.0点、外来担当 0.5点、外来指導 0.5点
- **日祝**: 上当直 1.0点、下当直 0.5点

## 🛠 技術構成

- **フロントエンド**: React 18, styled-components, axios
- **バックエンド**: Node.js, Express, moment.js
- **アルゴリズム**: 制約満足問題 + 貪欲法 + 公平性最適化

## 📁 プロジェクト構造

```
├── frontend/          # React フロントエンド
├── backend/           # Node.js バックエンド
├── docs/             # ドキュメント・サンプルファイル
└── package.json      # プロジェクト設定
```

## ⚠️ 制限事項

- 条件を満たせない場合は「条件をすべて満たす勤務表は作成できません」と表示
- 医師数が少ない場合や制約が厳しすぎる場合は生成に失敗する可能性

## 📖 サンプルデータ

`docs/sample.csv` にサンプルデータが含まれています。テスト用にご利用ください。
